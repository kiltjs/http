/*! jstool-http 2015-04-22 */
!function(a){"use strict";"undefined"!=typeof window&&(window.fn?fn.define("http",a):window.http||(window.http=a()))}(function(){"use strict";function a(){for(var b,c=[],d=c.shift.call(arguments),e=c.shift.call(arguments);e;){for(b in e)d[b]=d[b]instanceof Object&&e[b]instanceof Object?a({},e[b]):e[b];e=c.shift.call(arguments)}return d}function b(){for(var a=(arguments[0]||"").replace(/\/$/,""),b=1,c=arguments.length-1;c>b;b++)a+="/"+arguments[c].replace(/^\/|\/$/,"");return c&&(a+=arguments[c]?"/"+arguments[c].replace(/^\//,""):""),a}function c(a,b,d){if(a){if(b=b||"",d=d||0,a instanceof Function)return(d?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a());if(a instanceof Object){var e="";for(var f in a)e+=c(a[f],(b?b+".":"")+f,d++);return e}return(d?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}return""}function d(a){var b=a[0].toUpperCase()+a.substr(1);return b.replace(/([a-z])([A-Z])/,function(a,b,c){return b+"-"+c})}function e(a){var b=a[0].toLowerCase()+a.substr(1);return b.replace(/([a-z])-([A-Z])/,function(a,b,c){return b+c})}function f(a,b,c,d){var e=b.shift(),g=void 0;if(e||(e=b.$finally.shift()),e instanceof Function)e(c,a.status,a);else if(e instanceof Object&&(d&&e.resolve&&(g=e.resolve(c,a.status,a)),!d&&e.reject&&(g=e.reject(c,a.status,a)),g&&g.then)){if(b.forEach(function(a){g.then(a.resolve,a.reject)}),g.finally)b.$finally.forEach(function(a){g.finally(a.resolve,a.reject)});else if(b.$finally.length)throw"received promise not implements finally";e=!1}e&&f(a,b,void 0===g?c:g,d)}function g(a,b,c){a.headers={},a.getAllResponseHeaders().replace(/\s*([^\:]+)\s*\:\s*([^\;\n]+)/g,function(b,c,d){a.headers[e(c)]=d.trim()});var d=a.responseText;"application/json"===a.headers.contentType?d=JSON.parse(d):"application/xml"===a.headers.contentType&&(d=(new DOMParser).parseFromString(d,"text/xml")),c[a.status]?c[a.status].apply(a,[d,function(c){f(a,b,c,!0)},function(c){f(a,b,c,!0)}]):a.status>=200&&a.status<300?(a.$resolved=!0,f(a,b,d,!0)):f(a,b,d,!1)}function h(a){this.url=a}function i(e,f){if(e=e instanceof Array?b.apply(null,e):e,e instanceof Object&&(f=e,e=f.url),void 0===f)return new h(e);var j,k=a({},i.defaults),l={},m=[];for(j in f)f[j]instanceof Function&&(f[j]=f[j]()),k[j]instanceof Function&&(k[j]=k[j]()),"data"!==j&&f[j]instanceof Object?a(k[j],f[j]):k[j]=f[j];if(!e)throw"url missing";/^get$/.test(k.method)&&k.data instanceof Object&&Object.keys(k.data).length&&(console.log("options.data",k.data),e+="?"+c(k.data),k.data=null);var n=null;try{n=new XMLHttpRequest}catch(o){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(o){n=new ActiveXObject("Microsoft.XMLHTTP")}}if(null===n)throw"Browser does not support HTTP Request";n.open(k.method.toUpperCase(),e,void 0===k.async?!0:k.async);for(j in k.headers)n.setRequestHeader(d(j),k.headers[j]);return n.onreadystatechange=function(){("complete"===n.readyState||4===n.readyState)&&g(n,m,l)},void 0!==k.data&&"string"!=typeof k.data&&(k.data=JSON.stringify(k.data)),n.send(k.data),n.then=function(a,b){return a instanceof Function&&m.push({resolve:a,reject:b}),n},n.catch=function(a){return a instanceof Function&&m.push({resolve:null,reject:a}),n},m.$finally=[],n.finally=function(a){return m.$finally.push(a),n},n}return["get","head","options","post","put","delete","patch"].forEach(function(a){h.prototype[a]=function(){var b=[this.url];return[].push.apply(b,arguments),i[a].apply(null,b)}}),i.defaults={method:"get",headers:{contentType:"application/json"}},["get","head","options","post","put","delete"].forEach(function(a){i[a]=function(c,d,e){return c=c instanceof Array?b.apply(null,c):c,c instanceof Object&&(e=c,c=e.url),e=e||{},e.data=d,e.method=a,i(c,e)}}),i.patch=function(c,d,e){if(c=c instanceof Array?b.apply(null,c):c,c instanceof Object)return c.method="patch",i(c);if("string"==typeof c){if(e=e instanceof Object?e:{},d)return i(c,a(e,{method:"patch",data:d}));var f=[],g=function(a){return f.push(a),h},h={add:function(a,b){return g({op:"add",path:a,value:b})},test:function(a,b){return g({op:"test",path:a,value:b})},replace:function(a,b){return g({op:"replace",path:a,value:b})},move:function(a,b){return g({op:"move",from:a,path:b})},copy:function(a,b){return g({op:"copy",from:a,path:b})},remove:function(a){return g({op:"remove",path:a})},flush:function(){return f.splice(0,f.length),h},submit:function(b){return b=b||f,i(c,a(e,{method:"patch",data:b}))}};return h}},i});